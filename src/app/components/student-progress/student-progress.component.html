<!-- src/app/components/student-progress/student-progress.component.html -->

<div class="progress-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1>My Learning Progress</h1>
        <p class="subtitle">Track your German learning journey and achievements</p>
      </div>
      
      <div class="header-actions">
        <button class="btn btn-primary" (click)="router.navigate(['/learning-modules'])">
          <i class="fas fa-book"></i> Browse Modules
        </button>
      </div>
    </div>
  </div>

  <!-- Stats Overview -->
  <div class="stats-overview" *ngIf="stats">
    <div class="row g-4">
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-graduation-cap"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.totalModules }}</h3>
            <p>Total Modules</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-icon success">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.completedModules }}</h3>
            <p>Completed</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-icon info">
            <i class="fas fa-play-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.inProgressModules }}</h3>
            <p>In Progress</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-icon warning">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-content">
            <h3>{{ formatTimeSpent(stats.totalTimeSpent) }}</h3>
            <p>Time Spent</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-icon primary">
            <i class="fas fa-comments"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.totalSessions }}</h3>
            <p>AI Sessions</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-icon secondary">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats.averageScore }}%</h3>
            <p>Avg Score</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filters-container">
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Status</label>
          <select class="form-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
            <option value="">All Status</option>
            <option value="completed">Completed</option>
            <option value="in-progress">In Progress</option>
            <option value="paused">Paused</option>
            <option value="not-started">Not Started</option>
          </select>
        </div>
        
        <div class="col-md-3">
          <label class="form-label">Level</label>
          <select class="form-select" [(ngModel)]="selectedLevel" (change)="applyFilters()">
            <option value="">All Levels</option>
            <option value="A1">A1</option>
            <option value="A2">A2</option>
            <option value="B1">B1</option>
            <option value="B2">B2</option>
            <option value="C1">C1</option>
            <option value="C2">C2</option>
          </select>
        </div>
        
        <div class="col-md-3">
          <label class="form-label">Category</label>
          <select class="form-select" [(ngModel)]="selectedCategory" (change)="applyFilters()">
            <option value="">All Categories</option>
            <option value="Grammar">Grammar</option>
            <option value="Vocabulary">Vocabulary</option>
            <option value="Conversation">Conversation</option>
            <option value="Reading">Reading</option>
            <option value="Writing">Writing</option>
            <option value="Listening">Listening</option>
          </select>
        </div>
        
        <div class="col-md-3">
          <label class="form-label">&nbsp;</label>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary" (click)="clearFilters()">
              <i class="fas fa-times"></i> Clear
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading your progress...</p>
    </div>
  </div>

  <!-- Progress List -->
  <div class="progress-list" *ngIf="!isLoading">
    <div class="progress-item" *ngFor="let item of progress">
      <div class="progress-card">
        <!-- Card Header -->
        <div class="card-header">
          <div class="module-info">
            <h5 class="module-title">{{ item.moduleId.title }}</h5>
            <div class="module-meta">
              <span class="badge" [class]="'badge-' + getProgressColor(item.progressPercentage)">
                {{ item.moduleId.level }}
              </span>
              <span class="category">{{ item.moduleId.category }}</span>
            </div>
          </div>
          
          <div class="status-badge">
            <span class="badge" [class]="'badge-' + getProgressColor(item.progressPercentage)">
              <i class="fas" [class]="getStatusIcon(item.status)"></i>
              {{ item.status | titlecase }}
            </span>
          </div>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-section">
          <div class="progress-info">
            <span>Progress: {{ item.progressPercentage }}%</span>
            <span>Score: {{ item.totalScore }}/{{ item.maxPossibleScore }}</span>
          </div>
          <div class="progress">
            <div 
              class="progress-bar"
              [class]="'bg-' + getProgressColor(item.progressPercentage)"
              [style.width.%]="item.progressPercentage">
            </div>
          </div>
        </div>
        
        <!-- Stats -->
        <div class="progress-stats">
          <div class="stat-item">
            <i class="fas fa-clock"></i>
            <span>{{ formatTimeSpent(item.timeSpent || 0) }}</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-comments"></i>
            <span>{{ item.sessionsCount || 0 }} sessions</span>
          </div>
          <div class="stat-item" *ngIf="item.currentStreak > 0">
            <i class="fas fa-fire"></i>
            <span>{{ item.currentStreak }} streak</span>
          </div>
          <div class="stat-item" *ngIf="item.lastSessionDate">
            <i class="fas fa-calendar"></i>
            <span>{{ item.lastSessionDate | date:'short' }}</span>
          </div>
        </div>
        
        <!-- Actions -->
        <div class="progress-actions">
          <button 
            class="btn btn-outline-primary btn-sm"
            (click)="viewModuleDetails(item.moduleId._id)">
            View Module
          </button>
          
          <button 
            class="btn btn-success btn-sm"
            *ngIf="item.status !== 'completed'"
            (click)="startTutoring(item.moduleId._id)">
            <i class="fas fa-robot"></i> Continue Learning
          </button>
          
          <button 
            class="btn btn-info btn-sm"
            *ngIf="item.status === 'completed'"
            (click)="startTutoring(item.moduleId._id)">
            <i class="fas fa-redo"></i> Review
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && progress.length === 0">
    <div class="text-center">
      <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
      <h4>No Progress Yet</h4>
      <p class="text-muted">Start learning by enrolling in some modules!</p>
      <button class="btn btn-primary" (click)="router.navigate(['/learning-modules'])">
        Browse Learning Modules
      </button>
    </div>
  </div>
</div>