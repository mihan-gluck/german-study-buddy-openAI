<!-- src/app/components/admin-dashboard/admin-dashboard.component.html -->

<div class="admin-dashboard">

<!-- Filters -->
<div class="filters">
  <select [(ngModel)]="filters.level" (change)="applyFilters()">
    <option value="">Filter by Level</option>
    <option value="A1">A1</option>
    <option value="A2">A2</option>
    <option value="B1">B1</option>
    <option value="B2">B2</option>
  </select>

  <select [(ngModel)]="filters.plan" (change)="applyFilters()">
    <option value="">Filter by Plan</option>
    <option value="PLATINUM">PLATINUM</option>
    <option value="SILVER">SILVER</option>
  </select>

  <input type="number" [(ngModel)]="filters.batch" placeholder="Filter by Batch" (input)="applyFilters()">

    <!-- <select [(ngModel)]="filters.batch" (change)="applyFilters()">
      <option value="">All Status</option>
      <option value="active">Active</option>
      <option value="paused">Paused</option>
      <option value="finished">Finished</option>
    </select> -->

  </div>

  <!-- Bulk assignment
  <div class="bulk-assign">
    <input type="text" placeholder="Course Name" [(ngModel)]="bulkCourseName">
    <input type="text" placeholder="Assistant ID" [(ngModel)]="bulkAssistantId">
    <input type="text" placeholder="API Key" [(ngModel)]="bulkApiKey">
    <button (click)="bulkAssign()">Bulk Assign</button>
  </div> -->

  <!-- Reset Monthly Usage
  <div class="reset-usage">
    <button (click)="resetMonthlyUsage()">Reset Monthly Usage</button>
  </div> -->

  <div class="add-user">
    <button class="add-user-btn" routerLink="/signup">Add New User</button>
  </div>

  <!-- Students Table -->
  <table class="students-table">
    <thead>
      <tr>
        <!-- <th></th> -->
        <th>Name</th>
        <th>Email</th>
        <th>Plan</th>
        <th>Batch</th>
        <th>Level</th>
        <th>Assigned Teacher</th>
        <!-- <th>Course</th> -->
        <!-- <th>VAPI Status</th> -->
        <!-- <th>Fluency</th> -->
        <!-- <th>Grammar</th> -->
        <!-- <th>Accent</th> -->
        <!-- <th>Overall CFBR</th> -->
        <th>Bot Remaining Minutes</th>
        <th>Subscription Update Date</th>
        <!-- <th>ElevenLabs Link</th>
        <th>Course Progress</th>
        <th>Feedback</th> -->
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let student of filteredStudents; trackBy: trackById">
        <!-- <td>
          <input type="checkbox" [checked]="selectedStudentIds.has(student._id)" (change)="toggleStudentSelection(student._id)">
        </td> -->
        <td data-label="Name">{{ student.name }}</td>
        <td data-label="Email">{{ student.email }}</td>
        <td data-label="Plan">{{student.subscription}}</td>
        <td data-label="Batch">{{ student.batch || 'N/A' }}</td>
        <td data-label="Level">{{ student.level || 'N/A' }}</td>
        <td data-label="Assigned Teacher">{{ student.assignedTeacher?.name || 'N/A' }}</td>
        <!-- <td>
          <input type="text" [(ngModel)]="student.courseAssigned">
          <button (click)="assignCourseToStudent(student)">Assign</button>
        </td> -->
        <!-- <td>
          <select [value]="student.vapiAccess.status" (change)="onStatusChange($event, student._id)">
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="finished">Finished</option>
          </select>
        </td> -->
        <!-- <td>{{ student.feedbackStats?.fluency || 'N/A' }}</td>
        <td>{{ student.feedbackStats?.grammar || 'N/A' }}</td>
        <td>{{ student.feedbackStats?.accent || 'N/A' }}</td>
        <td>{{ student.feedbackStats?.overallCFBR || 'N/A' }}</td> -->
        <!-- <td>{{ student.feedbackStats?.currentLevel || 'N/A' }}</td> -->
        <td data-label="Bot Remaining Minutes">{{ student.remainingMinutes || 'N/A' }}</td>
        <td data-label="Subscription Update Date">{{ student.planUpgradeDate || 'N/A' }}</td>

        <!-- ElevenLabs column
        <td>
          <div *ngIf="!student.editingElevenLabs">
            <a *ngIf="student.elevenLabsLink" [href]="student.elevenLabsLink" target="_blank">Link</a>
            <span *ngIf="!student.elevenLabsLink">No link</span>
            <button (click)="student.editingElevenLabs = true">Edit</button>
          </div>
          <div *ngIf="student.editingElevenLabs">
            <input type="text" [(ngModel)]="student.elevenLabsLink" placeholder="Enter ElevenLabs link">
            <button (click)="saveElevenLabsLink(student)">Save</button>
            <button (click)="cancelEditElevenLabs(student)">Cancel</button>
          </div>
        </td>

        Course progress
        <td>
          <div *ngIf="student.courseProgress?.length; else noProgress">
            <div *ngFor="let progress of student.courseProgress">
              {{ progress.courseName }}: {{ progress.progressPercentage }}%
              <small>({{ progress.lastUpdated | date:'short' }})</small>
            </div>
          </div>
          <ng-template #noProgress>No progress</ng-template>
        </td>

        Feedback -->
        <!-- <td>
          <button (click)="loadFeedbackForStudent(student._id)">Load Feedback</button>
          <button (click)="exportFeedbackAsCSV(student._id)">Export CSV</button>
          <div *ngIf="feedbackMap[student._id]?.length">
            <ul>
              <li *ngFor="let fb of feedbackMap[student._id]">
                {{ fb.timestamp | date:'short' }} - {{ fb.summary }}
              </li>
            </ul>
          </div>
        </td> -->
      </tr>
    </tbody>
  </table>

</div>
